



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.1, mkdocs-material-2.0.4">
    
    
      
        <title>Specification - CDS Hooks</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-709eec9410.css">
      
    
    
      <script src="../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="CDS Hooks" class="md-header-nav__button md-logo">
          
            <img src="../images/logo-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Specification
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/cds-hooks/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../images/logo-square.png" width="24" height="24">
      
    </span>
    CDS Hooks
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/cds-hooks/docs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Specification
      </label>
    
    <a href="./" title="Specification" class="md-nav__link md-nav__link--active">
      Specification
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#discovery" title="Discovery" class="md-nav__link">
    Discovery
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-request" title="HTTP Request" class="md-nav__link">
    HTTP Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-status-codes" title="HTTP Status Codes" class="md-nav__link">
    HTTP Status Codes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-a-cds-service" title="Calling a CDS Service" class="md-nav__link">
    Calling a CDS Service
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-request_1" title="HTTP Request" class="md-nav__link">
    HTTP Request
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookinstance" title="hookInstance" class="md-nav__link">
    hookInstance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirect" title="redirect" class="md-nav__link">
    redirect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefetch" title="prefetch" class="md-nav__link">
    prefetch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cds-service-response" title="CDS Service Response" class="md-nav__link">
    CDS Service Response
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-decision-support" title="No Decision Support" class="md-nav__link">
    No Decision Support
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analytics" title="Analytics" class="md-nav__link">
    Analytics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefetch_1" title="Prefetch" class="md-nav__link">
    Prefetch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-performance-tweak" title="A performance tweak" class="md-nav__link">
    A performance tweak
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-request" title="Example prefetch request" class="md-nav__link">
    Example prefetch request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-response" title="Example prefetch response" class="md-nav__link">
    Example prefetch response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefetch-query-restrictions" title="Prefetch query restrictions" class="md-nav__link">
    Prefetch query restrictions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" title="Security" class="md-nav__link">
    Security
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trusting-cds-services" title="Trusting CDS Services" class="md-nav__link">
    Trusting CDS Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trusting-ehrs" title="Trusting EHRs" class="md-nav__link">
    Trusting EHRs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mutual-tls" title="Mutual TLS" class="md-nav__link">
    Mutual TLS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fhir-resource-access" title="FHIR Resource Access" class="md-nav__link">
    FHIR Resource Access
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obtaining-an-access-token" title="Obtaining an Access Token" class="md-nav__link">
    Obtaining an Access Token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-token" title="Access Token" class="md-nav__link">
    Access Token
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-origin-resource-sharing" title="Cross-Origin Resource Sharing" class="md-nav__link">
    Cross-Origin Resource Sharing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../hooks/" title="Hooks" class="md-nav__link">
      Hooks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../examples/" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#discovery" title="Discovery" class="md-nav__link">
    Discovery
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-request" title="HTTP Request" class="md-nav__link">
    HTTP Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" title="Response" class="md-nav__link">
    Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-status-codes" title="HTTP Status Codes" class="md-nav__link">
    HTTP Status Codes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calling-a-cds-service" title="Calling a CDS Service" class="md-nav__link">
    Calling a CDS Service
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-request_1" title="HTTP Request" class="md-nav__link">
    HTTP Request
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hookinstance" title="hookInstance" class="md-nav__link">
    hookInstance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirect" title="redirect" class="md-nav__link">
    redirect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefetch" title="prefetch" class="md-nav__link">
    prefetch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cds-service-response" title="CDS Service Response" class="md-nav__link">
    CDS Service Response
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-decision-support" title="No Decision Support" class="md-nav__link">
    No Decision Support
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analytics" title="Analytics" class="md-nav__link">
    Analytics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefetch_1" title="Prefetch" class="md-nav__link">
    Prefetch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-performance-tweak" title="A performance tweak" class="md-nav__link">
    A performance tweak
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-request" title="Example prefetch request" class="md-nav__link">
    Example prefetch request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-prefetch-response" title="Example prefetch response" class="md-nav__link">
    Example prefetch response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefetch-query-restrictions" title="Prefetch query restrictions" class="md-nav__link">
    Prefetch query restrictions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" title="Security" class="md-nav__link">
    Security
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trusting-cds-services" title="Trusting CDS Services" class="md-nav__link">
    Trusting CDS Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trusting-ehrs" title="Trusting EHRs" class="md-nav__link">
    Trusting EHRs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mutual-tls" title="Mutual TLS" class="md-nav__link">
    Mutual TLS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fhir-resource-access" title="FHIR Resource Access" class="md-nav__link">
    FHIR Resource Access
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obtaining-an-access-token" title="Obtaining an Access Token" class="md-nav__link">
    Obtaining an Access Token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-token" title="Access Token" class="md-nav__link">
    Access Token
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-origin-resource-sharing" title="Cross-Origin Resource Sharing" class="md-nav__link">
    Cross-Origin Resource Sharing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cds-hooks/docs/edit/master/docs/specification.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="cds-services">CDS Services<a class="headerlink" href="#cds-services" title="Permanent link">&para;</a></h1>
<h2 id="discovery">Discovery<a class="headerlink" href="#discovery" title="Permanent link">&para;</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl <span class="s2">&quot;https://example.com/cds-services&quot;</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;services&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;hook&quot;</span><span class="p">:</span> <span class="s2">&quot;patient-view&quot;</span><span class="p">,</span>
      <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Static CDS Service Example&quot;</span><span class="p">,</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;An example of a CDS service that returns a static set of cards&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;static-patient-greeter&quot;</span><span class="p">,</span>
      <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;patientToGreet&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/{{Patient.id}}&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;hook&quot;</span><span class="p">:</span> <span class="s2">&quot;medication-prescribe&quot;</span><span class="p">,</span>
      <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Medication Echo CDS Service&quot;</span><span class="p">,</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;An example of a CDS service that simply echos the medication being prescribed&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;medication-echo&quot;</span><span class="p">,</span>
      <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;patient&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/{{Patient.id}}&quot;</span><span class="p">,</span>
        <span class="nt">&quot;medications&quot;</span><span class="p">:</span> <span class="s2">&quot;MedicationOrder?patient={{Patient.id}}&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Developers of CDS Services must provide a well-known endpoint allowing the EHR to discover all available CDS Services, including information such as the purpose of the CDS Service, when it should be invoked, and any data that is requested to be prefetched.</p>
<h3 id="http-request">HTTP Request<a class="headerlink" href="#http-request" title="Permanent link">&para;</a></h3>
<p>The discovery endpoint is always available at <code>{baseUrl}/cds-services</code>. For example, if the <code>baseUrl</code> is https://example.com, the EHR would invoke:</p>
<p><code>GET https://example.com/cds-services</code></p>
<h3 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h3>
<p>The response to the discovery endpoint is an object containing a list of CDS Services.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>services</code></td>
<td><em>array</em>. An array of <strong>CDS Services</strong></td>
</tr>
</tbody>
</table>
<p>Each CDS Service is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hook</code></td>
<td><em>string</em> or <em>url</em>. The hook this service should be invoked on. See <a href="#hook-catalog">Hook Catalog</a></td>
</tr>
<tr>
<td><code>title</code></td>
<td><em>string</em>.  The human-friendly name of this service</td>
</tr>
<tr>
<td><nobr><code>description</code></nobr></td>
<td><em>string</em>. The description of this service</td>
</tr>
<tr>
<td><code>id</code></td>
<td><em>string</em>. The {id} portion of the URL to this service which is available at<br /><code>{baseUrl}/cds-services/{id}</code></td>
</tr>
<tr>
<td><code>prefetch</code></td>
<td><em>object</em>. An object containing key/value pairs of FHIR queries to data that this service would like the EHR prefetch and provide on<br />each service call. The key is a <em>string</em> that describes the type<br />of data being requested and the value is a <em>string</em> representing<br />the FHIR query.<br />(todo: link to prefetching documentation)</td>
</tr>
</tbody>
</table>
<h3 id="http-status-codes">HTTP Status Codes<a class="headerlink" href="#http-status-codes" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>200 OK</code></td>
<td>A successful response</td>
</tr>
</tbody>
</table>
<h2 id="calling-a-cds-service">Calling a CDS Service<a class="headerlink" href="#calling-a-cds-service" title="Permanent link">&para;</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl
  -X POST \
  -H &#39;Content-type: application/json&#39; \
  --data @hook-details-see-example-below
  &quot;https://example.com/cds-services/static-patient-greeter&quot;
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;hookInstance&quot;</span> <span class="p">:</span> <span class="s2">&quot;d1577c69-dfbe-44ad-ba6d-3e05e953b2ea&quot;</span><span class="p">,</span>
   <span class="nt">&quot;fhirServer&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://hooks.smarthealthit.org:9080&quot;</span><span class="p">,</span>
   <span class="nt">&quot;hook&quot;</span> <span class="p">:</span> <span class="s2">&quot;patient-view&quot;</span><span class="p">,</span>
   <span class="nt">&quot;redirect&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://hooks2.smarthealthit.org/service-done.html&quot;</span><span class="p">,</span>
   <span class="nt">&quot;user&quot;</span> <span class="p">:</span> <span class="s2">&quot;Practitioner/example&quot;</span><span class="p">,</span>
   <span class="nt">&quot;context&quot;</span> <span class="p">:</span> <span class="p">[],</span>
   <span class="nt">&quot;patient&quot;</span> <span class="p">:</span> <span class="s2">&quot;1288992&quot;</span><span class="p">,</span>
   <span class="nt">&quot;prefetch&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;patientToGreet&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="nt">&quot;response&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;status&quot;</span> <span class="p">:</span> <span class="s2">&quot;200 OK&quot;</span>
         <span class="p">},</span>
         <span class="nt">&quot;resource&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;resourceType&quot;</span> <span class="p">:</span> <span class="s2">&quot;Patient&quot;</span><span class="p">,</span>
            <span class="nt">&quot;gender&quot;</span> <span class="p">:</span> <span class="s2">&quot;male&quot;</span><span class="p">,</span>
            <span class="nt">&quot;birthDate&quot;</span> <span class="p">:</span> <span class="s2">&quot;1925-12-23&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;1288992&quot;</span><span class="p">,</span>
            <span class="nt">&quot;active&quot;</span> <span class="p">:</span> <span class="kc">true</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="http-request_1">HTTP Request<a class="headerlink" href="#http-request_1" title="Permanent link">&para;</a></h3>
<p>An EHR calls a CDS service by <code>POST</code>ing a JSON document to the service
endpoint, which can be constructed from the CDS Service base URL and an
individual service id as <code>{baseUrl}/cds-services/{service.id}</code>.  The CDS Hook
call includes a JSON POST body with the following input fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hook</code></td>
<td><em>string</em> or <em>URL</em>. The hook that triggered this CDS Service call<br />(todo: link to hook documentation)</td>
</tr>
<tr>
<td><nobr><code>hookInstance</code></nobr></td>
<td><em>string</em>.  A UUID for this particular hook call (see more information below)</td>
</tr>
<tr>
<td><code>fhirServer</code></td>
<td><em>URL</em>.  The base URL EHR's <a href="https://www.hl7.org/fhir/">FHIR</a> server. The scheme should be <code>https</code></td>
</tr>
<tr>
<td><code>fhirAuthorization</code></td>
<td><em>object</em>. The OAuth 2 authorization providing access to the EHR's FHIR server. See the <a href="#fhir-resource-access">FHIR Resource Access</a> heading of the security section for more information.</td>
</tr>
<tr>
<td><code>redirect</code></td>
<td><em>URL</em>.  The URL an app link card should redirect to (see more information below)</td>
</tr>
<tr>
<td><code>user</code></td>
<td><em>string</em>.  The FHIR resource type + id representing the current user.<br />The type is one of: <a href="https://www.hl7.org/fhir/practitioner.html">Practitioner</a>, <a href="https://www.hl7.org/fhir/patient.html">Patient</a>, or <a href="https://www.hl7.org/fhir/relatedperson.html">RelatedPerson</a>.<br />For example, <code>Practitioner/123</code></td>
</tr>
<tr>
<td><code>patient</code></td>
<td><em>string</em>.  The FHIR <code>Patient.id</code> of the current patient in context</td>
</tr>
<tr>
<td><code>encounter</code></td>
<td><em>string</em>.  The FHIR <code>Encounter.id</code> of the current encounter in context</td>
</tr>
<tr>
<td><code>context</code></td>
<td><em>object</em>.  Hook-specific contextual data that the CDS service will need.<br />For example, with the <code>medication-prescribe</code> hook this will include <a href="https://www.hl7.org/fhir/medicationorder.html">MedicationOrder</a> being prescribed.</td>
</tr>
<tr>
<td><code>prefetch</code></td>
<td><em>object</em>.  The FHIR data that was prefetched by the EHR (see more information below)</td>
</tr>
</tbody>
</table>
<h4 id="hookinstance">hookInstance<a class="headerlink" href="#hookinstance" title="Permanent link">&para;</a></h4>
<p>While working in the EHR, a user can perform
multiple activities in series or in parallel. For example, a clinician might prescribe
two drugs in a row; each prescription activity would be assigned a
unique <code>hookInstance</code>. The [[activity catalog|Activity]]
provides a description of what events should initiate and terminate
a given hook. This allows an external
service to associate requests with activity state, which is necessary to
support the following app-centric decision sequence, where
the steps are tied together by a common <code>hookInstance</code>:</p>
<ol>
<li>EHR invokes CDS hook</li>
<li>CDS service returns <em>app link card</em></li>
<li>User clicks app link and interacts with app</li>
<li>Flow returns to EHR, which re-invokes CDS hook</li>
<li>CDS service returns <em>decision</em> with user's choice</li>
</ol>
<p>Note: the <code>hookInstance</code> is globally unique and should contain enough entropy
to be un-guessable.</p>
<h4 id="redirect">redirect<a class="headerlink" href="#redirect" title="Permanent link">&para;</a></h4>
<p>This field is only used by services that will return an <em>app
link card</em>: when a user clicks the card's link to launch an app, it becomes
the app's job to send the user to <em>this <code>redirect</code> URL</em> upon completion of
user interaction. (<em>Design note</em>: this field is supplied up-front, as part of
the initial request, to avoid requiring the EHR to append any content to app
launch links. This helps support an important "degenerate" use case for app
link cards: pointing to static content. See below for details.)</p>
<h4 id="prefetch">prefetch<a class="headerlink" href="#prefetch" title="Permanent link">&para;</a></h4>
<p>As a performance tweak, the EHR may pass along data according
to the service's [[Prefetch-Template]]. This helps provide the service with all
the data it needs to efficiently compute a set of recommendations. Each key matches a key described in the CDS Service Discovery document; and each value is a FHIR Bundle.entry indicating a response status and returned resource.</p>
<p>Note that in the absence of <code>prefetch</code>, an external service can always execute
FHIR REST API calls against the EHR server to obtain additional data ad-hoc.)</p>
<aside class="notice">
You can see the <a href="http://editor.swagger.io/?url=https://raw.githubusercontent.com/cds-hooks/api/master/cds-hooks.yaml">complete data model in Swagger</a>.
</aside>

<h2 id="cds-service-response">CDS Service Response<a class="headerlink" href="#cds-service-response" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Example response</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;cards&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Example Card&quot;</span><span class="p">,</span>
      <span class="nt">&quot;indicator&quot;</span><span class="p">:</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
      <span class="nt">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;This is an example card.&quot;</span><span class="p">,</span>
      <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Static CDS Service Example&quot;</span><span class="p">,</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
        <span class="nt">&quot;icon&quot;</span><span class="p">:</span> <span class="s2">&quot;https://example.com/img/icon-100px.png&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;links&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Google&quot;</span><span class="p">,</span>
          <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://google.com&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;absolute&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Github&quot;</span><span class="p">,</span>
          <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;absolute&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;SMART Example App&quot;</span><span class="p">,</span>
          <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://smart.example.com/launch&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;smart&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Another card&quot;</span><span class="p">,</span>
      <span class="nt">&quot;indicator&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
      <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Static CDS Service Example&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cards</code></td>
<td><em>array</em>. An array of <strong>Cards</strong>. Cards can provide a combination of information (for reading), suggested actions (to be applied if a user selects them), and links (to launch an app if the user selects them). The EHR decides how to display cards, but we recommend displaying suggestions using buttons, and links using underlined text.</td>
</tr>
<tr>
<td><nobr><code>decisions</code></nobr></td>
<td><em>array</em>. An array of <strong>Decisions</strong>. A decision should only be generated after interacting with the user through an app link. Decisions are designed to convey any choices the user made in an app session.</td>
</tr>
</tbody>
</table>
<p>represents a user's choice made while interacting with the CDS Provider's external app. The first call to a service should never include any <code>decisions</code>, since no user interaction has occurred yet.</p>
<p>Each <strong>Card</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>summary</code></td>
<td><em>string</em>. one-sentence, &lt;140-character summary message for display to the user inside of this card.</td>
</tr>
<tr>
<td><code>detail</code></td>
<td><em>string</em>.  optional detailed information to display, represented in <a href="https://github.github.com/gfm/">(GitHub Flavored) Markdown</a>. (For non-urgent cards, the EHR may hide these details until the user clicks a link like "view more details...".)</td>
</tr>
<tr>
<td><code>indicator</code></td>
<td><em>string</em>.  urgency/importance of what this card conveys. Allowed values, in order of increasing urgency, are: <code>info</code>, <code>warning</code>, <code>hard-stop</code>. The EHR can use this field to help make UI display decisions such as sort order or coloring. The value <code>hard-stop</code> indicates that the workflow should not be allowed to proceed.</td>
</tr>
<tr>
<td><code>source</code></td>
<td><em>object</em>. grouping structure for the <strong>Source</strong> of the information displayed on this card. The source should be the primary source of guidance for the decision support the card represents.</td>
</tr>
<tr>
<td><nobr><code>suggestions</code></nobr></td>
<td><em>array</em> of <strong>Suggestions</strong>, which allow a service to suggest a set of changes in the context of the current activity (e.g.  changing the dose of the medication currently being prescribed, for the <code>medication-prescribe</code> activity). The user must be allowed to choose at most one suggestion.</td>
</tr>
<tr>
<td><code>links</code></td>
<td><em>array</em> of <strong>Links</strong>, which allow a service to suggest a link to an app that the user might want to run for additional information or to help guide a decision.</td>
</tr>
</tbody>
</table>
<p>The <strong>Source</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><nobr><code>label</code></nobr></td>
<td><em>string</em>. A short, human-readable label to display for the source of the information displayed on this card. If a <code>url</code> is also specified, this may be the text for the hyperlink.</td>
</tr>
<tr>
<td><code>url</code></td>
<td><em>URL</em>. An optional absolute URL to load (via <code>GET</code>, in a browser context) when a user clicks on this link to learn more about the organization or data set that provided the information on this card. Note that this URL should not be used to supply a context-specific "drill-down" view of the information on this card. For that, use <code>link.url</code> instead.</td>
</tr>
<tr>
<td><code>icon</code></td>
<td><em>URL</em>. An optional absolute URL to an icon for the source of this card. The icon returned by this URL should be in PNG format, an image size of 100x100 pixels, and must not include any transparent regions.</td>
</tr>
</tbody>
</table>
<p>Each <strong>Suggestion</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>label</code></td>
<td><em>string</em>. human-readable label to display for this suggestion (e.g. the EHR might render this as the text on a button tied to this suggestion).</td>
</tr>
<tr>
<td><code>uuid</code></td>
<td><em>string</em>. unique identifier for this suggestion. For details see <a href="#analytics">Suggestion Tracking Analytics</a></td>
</tr>
<tr>
<td><code>actions</code></td>
<td><em>array</em>. array of objects, each defining a suggested action. Within a suggestion, all actions are logically AND'd together, such that a user selecting a suggestion selects all of the actions within it.</td>
</tr>
</tbody>
</table>
<p>Each <strong>Action</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td><em>string</em>. The type of action being performed. Allowed values are: <code>create</code>, <code>update</code>, <code>delete</code>.</td>
</tr>
<tr>
<td><code>description</code></td>
<td><em>string</em>. human-readable description of the suggested action. May be presented to the end-user.</td>
</tr>
<tr>
<td><code>resource</code></td>
<td><em>object</em>. depending upon the <code>type</code> attribute, a new resource or the id of a resource. For a type of <code>create</code>, the <code>resource</code> attribute contains a new FHIR resource to apply within the current activity (e.g. for <code>medication-prescribe</code>, this holds the updated prescription as proposed by the suggestion).  For <code>delete</code>, this is the id of any resource to remove from the current activity (e.g. for the <code>order-review</code> activity, this would provide a way to remove an order from the pending list). In activities like <code>medication-prescribe</code> where only one "content" resource is ever relevant, this field may be omitted. For <code>update</code>, this holds the updated resource to modify from the current activity (e.g. for the <code>order-review</code> activity, this would provide a way to annotate an order from the pending list with an assessment). This field may be omitted.</td>
</tr>
</tbody>
</table>
<p>Each <strong>Link</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><nobr><code>label</code></nobr></td>
<td><em>string</em>. human-readable label to display for this link (e.g. the EHR might render this as the underlined text of a clickable link).</td>
</tr>
<tr>
<td><code>url</code></td>
<td><em>URL</em>. URL to load (via <code>GET</code>, in a browser context) when a user clicks on this link. Note that this may be a "deep link" with context embedded in path segments, query parameters, or a hash. In general this URL should embed enough context for the app to determine the <code>hookInstance</code>, and <code>redirect</code> url upon downstream launch, because the EHR will simply use this url as-is, without appending any parameters at launch time.</td>
</tr>
<tr>
<td><code>type</code></td>
<td><em>string</em>. The type of the given URL. There are two possible values for this field. A type of <code>absolute</code> indicates that the URL is absolute and should be treated as-is. A type of <code>smart</code> indicates that the URL is a SMART app launch URL and the EHR should ensure the SMART app launch URL is populated with the appropriate SMART launch parameters.</td>
</tr>
</tbody>
</table>
<p>Each <strong>Decision</strong> is described by the following attributes.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create</code></td>
<td><em>array</em> of <em>strings</em>. id(s) of new resource(s) that the EHR should create within the current activity (e.g. for <code>medication-prescribe</code>, this would be the updated prescription that a user had authored in an app session).</td>
</tr>
<tr>
<td><nobr><code>delete</code></nobr></td>
<td><em>array</em> of <em>strings</em>. id(s) of any resources to remove from the current activity (e.g. for the <code>order-review</code> activity, this would provide a way to remove orders from the pending list). In activities like <code>medication-prescribe</code> where only one "content" resource is ever relevant, this field may be omitted.</td>
</tr>
</tbody>
</table>
<h3 id="no-decision-support">No Decision Support<a class="headerlink" href="#no-decision-support" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Response when no decision support is necessary for the user</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;cards&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>If your CDS Service has no decision support for the user, your service should return a 200 HTTP response with an empty array of cards.</p>
<h2 id="analytics">Analytics<a class="headerlink" href="#analytics" title="Permanent link">&para;</a></h2>
<p>Whenever a user clicks a button from a "suggestion" card, the EHR uses the
suggestion <code>uuid</code> to notify the CDS Service's analytics endpoint via a <code>POST</code>
with an empty body:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>`POST {baseUrl}/cds-services/{serviceId}/analytics/{uuid}`
</pre></div>
</td></tr></table>

<p>If a suggestion has no <code>uuid</code>, the EHR does not send a notification.</p>
<h2 id="prefetch_1">Prefetch<a class="headerlink" href="#prefetch_1" title="Permanent link">&para;</a></h2>
<h3 id="a-performance-tweak">A performance tweak<a class="headerlink" href="#a-performance-tweak" title="Permanent link">&para;</a></h3>
<p>If real-world performance were no issue, an EHR could launch a CDS Service
passing only <em>context</em> data, and <em>without passing any additional clinical data</em>
up-front. The CDS Service could then request any data it needed via the EHR's
FHIR REST API.</p>
<p>But CDS services must respond quickly (on the order of 500 ms), and so we
provide a performance tweak that allows a CDS Service to register a set of "prefetch
templates" with the EHR ahead of time.</p>
<p>The prefetch templates are a dictionary of <code>read</code> and <code>search</code> requests to supply
relevant data, where the following variables are defined:</p>
<table>
<thead>
<tr>
<th>variable</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>{{Patient.id}}</code></td>
<td>The id of the patient in context for this activity (e.g. <code>123</code>)</td>
</tr>
<tr>
<td><code>{{User.id}}</code></td>
<td>The type and id of the user for this session (e.g. <code>Practitioner/123</code>)</td>
</tr>
</tbody>
</table>
<p>An EHR <em>may</em> choose to honor some or all of the desired prefetch templates from an appropriate source. For example:</p>
<ul>
<li>The EHR may have some of the desired prefetched data already in memory, thereby removing the need for any network call</li>
<li>The EHR may compute an efficient set of prefetch templates from multiple CDS Services, thereby reducing the number of network calls to a minimum</li>
<li>The EHR may satisfy some of the desired prefetched templates via some internal service or even its own FHIR server</li>
<li>The user may not be authorized to share the desired prefetch data.</li>
</ul>
<p>Regardless of how the EHR satisfies the prefetched templates (if at all), it is important that the prefetched data given to the CDS Service is equivalent to the CDS Service making its own call to the EHR FHIR server, where <code>{{Patient.id}}</code> is replaced with the id of the current patient (e.g. <code>123</code>) inside of any URL strings and using <code>read</code> and <code>search</code> operations to the server's "transaction" endpoint as a FHIR batch-type bundle.</p>
<p>The resulting response, which must be rendered in a single page — no "next
page" links allowed — is passed along to the CDS Service using the
<code>prefetch</code> parameter (see below for a complete example). </p>
<p>The CDS Service must not receive any prefetch template key that the EHR chooses not to satisfy. Additionally, if the EHR encounters an error while retrieving any prefetched data, the prefetch template key should not be sent to the CDS Service. It is the CDS Service's responsibility to check to see what prefetched data was satisfied (if any) and manually retrieve any necessary data. If the CDS Service is unable to obtain required data because it cannot access the FHIR server and the request did not contain the necessary pre-fetch keys; the service shall respond with an HTTP 412 Precondition Failed status code.</p>
<h3 id="example-prefetch-request">Example prefetch request<a class="headerlink" href="#example-prefetch-request" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;p&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/{{Patient.id}}&quot;</span><span class="p">,</span>
    <span class="nt">&quot;a1c&quot;</span><span class="p">:</span> <span class="s2">&quot;Observation?patient={{Patient.id}}&amp;code=4548-4&amp;_count=1&amp;sort:desc=date&quot;</span><span class="p">,</span>
    <span class="nt">&quot;u&quot;</span><span class="p">:</span> <span class="s2">&quot;Practitioner/{{User.id}}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Here is an example prefetch property from a CDS service discovery endpoint. The
goal is to know, at call time:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>p</code></td>
<td>Patient demographics</td>
</tr>
<tr>
<td><code>a1c</code></td>
<td>Most recent Hemoglobin A1c reading for this patient</td>
</tr>
<tr>
<td><code>u</code></td>
<td>Information on the current user (Practitioner)</td>
</tr>
</tbody>
</table>
<h3 id="example-prefetch-response">Example prefetch response<a class="headerlink" href="#example-prefetch-response" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;prefetch&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;p&quot;</span><span class="p">:{</span>
      <span class="nt">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;200 OK&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient&quot;</span><span class="p">,</span>
        <span class="nt">&quot;gender&quot;</span><span class="p">:</span> <span class="s2">&quot;male&quot;</span><span class="p">,</span>
        <span class="nt">&quot;birthDate&quot;</span><span class="p">:</span> <span class="s2">&quot;1974-12-25&quot;</span><span class="p">,</span>
        <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;snipped for brevity&gt;&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;a1c&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;200 OK&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;resource&quot;</span><span class="p">:{</span>
        <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Bundle&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;searchset&quot;</span><span class="p">,</span>
        <span class="nt">&quot;entry&quot;</span><span class="p">:</span> <span class="p">[{</span>
          <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Observation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://loinc.org&quot;</span><span class="p">,</span>
                <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;4548-4&quot;</span><span class="p">,</span>
                <span class="nt">&quot;display&quot;</span><span class="p">:</span> <span class="s2">&quot;Hemoglobin A1c&quot;</span>
              <span class="p">}]</span>
            <span class="p">},</span>
            <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;snipped for brevity&gt;&quot;</span>
          <span class="p">}</span>
        <span class="p">}]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The response is augmented to include two prefetch values, where the dictionary
keys match the request keys (<code>p</code> and <code>a1c</code> in this case).</p>
<p>Note that the missing <code>u</code> key indicates that either the EHR has decided not to satisfy this particular prefetch template or it was not able to retrieve this prefetched data. The CDS Service is responsible for retrieving this Practitioner data from the FHIR server (if required).</p>
<h3 id="prefetch-query-restrictions">Prefetch query restrictions<a class="headerlink" href="#prefetch-query-restrictions" title="Permanent link">&para;</a></h3>
<p>To reduce the implementation burden on EHRs that support CDS services, CDS Hooks recommends that prefetch queries only use a subset of the full functionality available in the FHIR specification. Valid prefetch URLs should only contain:</p>
<ul>
<li><em>instance</em> level <a href="https://www.hl7.org/fhir/http.html#read">read</a> interactions (for resources with known ids such as <code>Patient</code> and <code>Practitioner</code>)</li>
<li><em>type</em> level <a href="https://www.hl7.org/fhir/http.html#search">search</a> interactions</li>
<li>Patient references (e.g. <code>patient={{Patient}}</code>)</li>
<li><em>token</em> search parameters using equality (e.g. <code>code=4548-4</code>) and optionally the <code>:in</code> modifier (no other modifiers for token parameters)</li>
<li><em>date</em> search parameters on <code>date</code>, <code>dateTime</code>, <code>instant</code>, or <code>Period</code> types only, and using only the prefixes <code>eq</code>, <code>lt</code>, <code>gt</code>, <code>ge</code>, <code>le</code></li>
<li>the <code>_count</code> parameter to limit the number of results returned</li>
<li>the <code>_sort</code> parameter to allow for <em>most recent</em> and <em>first</em> queries</li>
</ul>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<aside class="notice">
The CDS Hooks security model is undergoing a rigorous security assessment and as such, may be subject to change.
</aside>

<p>CDS Hooks defines the agreed upon security model between an EHR and the CDS Service. Like SMART on FHIR, the security model of CDS Hooks leverages the same open and well supported standards like OAuth 2 and JSON web tokens. However, as CDS Hooks differs from SMART, the manner in which these standards are used is specific to CDS Hooks.</p>
<h3 id="trusting-cds-services">Trusting CDS Services<a class="headerlink" href="#trusting-cds-services" title="Permanent link">&para;</a></h3>
<p>As the EHR initiates every interaction with the CDS Service, it is responsible for establishing trust with the CDS Services it intends to call. This trust is established via a TLS connection to the CDS Service. Thus, all CDS Service endpoints must be deployed to a TLS protected URL (https). This includes both the Discovery and individual CDS Service endpoints.</p>
<p>EHRs should use accepted best practices for verifying the authenticity and trust of these TLS connections. For instance, <a href="https://tools.ietf.org/html/rfc5280">rfc5280</a> and <a href="https://tools.ietf.org/html/rfc6125">rfc6125</a>. Additionally, it is assumed that EHRs configure the CDS Services they connect to via some offline process according to the business rules and practices of both the EHR and CDS Service organizations.</p>
<h3 id="trusting-ehrs">Trusting EHRs<a class="headerlink" href="#trusting-ehrs" title="Permanent link">&para;</a></h3>
<p>Since the CDS Service is invoked by the EHR, the CDS Service does not have the same mechanism as EHRs to establish trust of the EHR invoking it. Signed <a href="https://jwt.io/">JSON web tokens (JWT)</a> are produced by the EHR and provided to the CDS Service, allowing the CDS Service to establish trust of the calling EHR.</p>
<p>Each time the EHR makes a request to the CDS Service, it must send an <code>Authorization</code> header where the value is <code>Bearer &lt;token&gt;</code>, replacing <code>&lt;token&gt;</code> with the actual JWT. Note that this is for every single CDS Service call, whether that be Discovery calls, CDS Service invocations, etc.</p>
<blockquote>
<p>Example JSON web token payload</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;iss&quot;</span><span class="p">:</span> <span class="s2">&quot;https://fhir-ehr.example.com/&quot;</span><span class="p">,</span>
  <span class="nt">&quot;aud&quot;</span><span class="p">:</span> <span class="s2">&quot;https://cds.example.org/cds-services/some-service&quot;</span><span class="p">,</span>
  <span class="nt">&quot;exp&quot;</span><span class="p">:</span> <span class="mi">1422568860</span><span class="p">,</span>
  <span class="nt">&quot;iat&quot;</span><span class="p">:</span> <span class="mi">1311280970</span><span class="p">,</span>
  <span class="nt">&quot;jti&quot;</span><span class="p">:</span> <span class="s2">&quot;ee22b021-e1b7-4611-ba5b-8eec6a33ac1e&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Using the above JWT payload, the complete JWT as passed in the Authorization HTTP header would be:</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwczovL2ZoaXItZWhyLmV4YW1wbGUuY29tLyIsImF1ZCI6Imh0dHBzOi8vY2RzLmV4YW1wbGUub3JnL2Nkcy1zZXJ2aWNlcy9zb21lLXNlcnZpY2UiLCJleHAiOjE0MjI1Njg4NjAsImlhdCI6MTMxMTI4MDk3MCwianRpIjoiZWUyMmIwMjEtZTFiNy00NjExLWJhNWItOGVlYzZhMzNhYzFlIn0.Gwl3s301OMWpdEVAVj_T3JZV8bs7N5-V7QNNG7TQ33o
</pre></div>
</td></tr></table>

<p>The JWT from the EHR is signed with the EHR's private key and contains the following fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>iss</td>
<td><em>string</em> The URL of the issuer of this JWT.</td>
</tr>
<tr>
<td>aud</td>
<td><em>string or array of strings</em> The CDS Service endpoint that is being called by the EHR. (See more details below).</td>
</tr>
<tr>
<td>exp</td>
<td><em>number</em> Expiration time integer for this authentication JWT, expressed in seconds since the "Epoch" (1970-01-01T00:00:00Z UTC).</td>
</tr>
<tr>
<td>iat</td>
<td><em>number</em> The time at which this JWT was issued, expressed in seconds since the "Epoch" (1970-01-01T00:00:00Z UTC).</td>
</tr>
<tr>
<td>jti</td>
<td><em>string</em> A nonce string value that uniquely identifies this authentication JWT (used to protect against replay attacks)</td>
</tr>
</tbody>
</table>
<p>Per <a href="https://tools.ietf.org/html/rfc7519#section-4.1.3">rfc7519</a>, the <code>aud</code> value is either a string or an array of strings. For CDS Hooks, this is the URL of the CDS Service endpoint being invoked. For example, consider a CDS Service available at a base URL of <code>https://cds.example.org</code>. When the EHR invokes the CDS Service discovery endpoint, the aud value is either <code>"https://cds.example.org/cds-services"</code> or <code>["https://cds.example.org/cds-services"]</code>. Similarly, when the EHR invokes a particular CDS Service (say, <code>some-service</code>), the aud value is either <code>"https://cds.example.org/cds-services/some-service"</code> or <code>["https://cds.example.org/cds-services/some-service"]</code>.</p>
<p><a href="https://jwt.io/">https://jwt.io/</a> is a great resource not only for learning about JSON web tokens, but also for parsing a JWT value into its distinct parts to see how it is constructed. Try taking the example JWT here and pasting it into the form at <a href="https://jwt.io/">https://jwt.io/</a> to see how the token is constructed.</p>
<aside class="notice">
At this time, CDS Hooks does not prescribe how the EHR shares its public key or the format of said key used in the JWT signature.
</aside>

<h4 id="mutual-tls">Mutual TLS<a class="headerlink" href="#mutual-tls" title="Permanent link">&para;</a></h4>
<p><a href="https://en.wikipedia.org/wiki/Mutual_authentication">Mutual TLS</a> (mTLS) may be used alongside JSON web tokens to establish trust of the EHR by the CDS Service.</p>
<h3 id="fhir-resource-access">FHIR Resource Access<a class="headerlink" href="#fhir-resource-access" title="Permanent link">&para;</a></h3>
<p>The CDS Service is able to use the FHIR server of the EHR to obtain any additional data it needs in order to perform its decision support. This is similar to SMART on FHIR where the SMART app can obtain additional data via the provided FHIR server.</p>
<p>Like SMART on FHIR, CDS Hooks requires that access to the FHIR server be controlled by an Authorization server utilizing the OAuth 2 framework. Thus, the CDS Service is able to consume the given FHIR server via an access (bearer) token just like a SMART app. While CDS Hooks shares the underlying technical framework and standards as SMART on FHIR, there are very important differences between SMART and CDS Hooks.</p>
<h4 id="obtaining-an-access-token">Obtaining an Access Token<a class="headerlink" href="#obtaining-an-access-token" title="Permanent link">&para;</a></h4>
<p>In SMART on FHIR, the SMART app requests and ultimately obtains an access token from the Authorization server using the SMART launch workflow. This process utilizes the authorization code grant model as defined by the OAuth 2.0 Authorization Framework in <a href="https://tools.ietf.org/html/rfc6749">rfc6749</a>.</p>
<p>With CDS Hooks, the EHR provides the access token directly in the request to the CDS Service. Thus, the CDS Service does not need to request the token from the authorization server as a SMART app would. This is done purely for performance reasons as the authorization code grant model in OAuth 2 involves several HTTPS calls and redirects. In contrast to a SMART app, a CDS Service may be invoked many times during a workflow. Going through the authorization code grant model on every hook invocation would likely result in a poorly performing CDS Service due to the authorization overhead.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;fhirAuthorization&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;access_token&quot;</span> <span class="p">:</span> <span class="s2">&quot;some-opaque-fhir-access-token&quot;</span><span class="p">,</span>
    <span class="nt">&quot;token_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
    <span class="nt">&quot;expires_in&quot;</span> <span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
    <span class="nt">&quot;scope&quot;</span> <span class="p">:</span> <span class="s2">&quot;patient/Patient.read patient/Observation.read&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h4 id="access-token">Access Token<a class="headerlink" href="#access-token" title="Permanent link">&para;</a></h4>
<p>The access token is specified in the CDS Service request via the <code>fhirAuthorization</code> request parameter. This parameter is an object that contains both the access token as well as other related information.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>access_token</code></td>
<td><em>string</em>. This is the OAuth 2 access token that provides access to the FHIR server.</td>
</tr>
<tr>
<td><code>token_type</code></td>
<td><em>string</em>. Fixed value: <code>Bearer</code></td>
</tr>
<tr>
<td><code>expires_in</code></td>
<td><em>integer</em>. The lifetime in seconds of the access token.</td>
</tr>
<tr>
<td><code>scope</code></td>
<td><em>string</em>. The scopes the access token grants the CDS Service.</td>
</tr>
</tbody>
</table>
<p>It is recommended that the <code>expires_in</code> value be very short lived as the access token must be treated as a transient value by the CDS Service.</p>
<p>It is recommended that the <code>scope</code> value contain just the scopes that the CDS Service needs for its logic and no more.</p>
<p>As the CDS Service is executing on behalf of a user, it is important that the data the CDS Service has access to is under the same restrictions/authorization as the current user. As such, the access token shall be scoped to:</p>
<ul>
<li>The CDS Service being invoked</li>
<li>The current user</li>
</ul>
<h3 id="cross-origin-resource-sharing">Cross-Origin Resource Sharing<a class="headerlink" href="#cross-origin-resource-sharing" title="Permanent link">&para;</a></h3>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">Cross-origin resource sharing (CORS)</a> is web security mechanism that is built into browsers. In short, CORS allows servers to control how browsers access resources on the server, including the accessible HTTP response headers. CORS is only honored by web browsers and as such, is a client-side security mechanism.</p>
<p>For CDS Services, implementing CORS is required if your CDS Service is to be called from a web browser. As the <a href="http://sandbox.cds-hooks.org">CDS Hooks Sandbox</a> is a browser application, you must implement CORS to test your CDS Service in the CDS Hooks Sandbox.</p>
<p>You should carefully consider if and how you support CORS in your CDS Service. A secure implementation guide for CORS is outside of the CDS Hooks specification, as it involves implementation decisions that are made based upon your organization's tolerance for risk and deployment environment.</p>
<p>An insecure, extremely permissive, non-production CORS configuration that allows you to test your CDS Service against our Sandbox returns the following HTTP headers:</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access-Control-Allow-Credentials</td>
<td>true</td>
</tr>
<tr>
<td>Access-Control-Allow-Headers</td>
<td>Authorization, Content-Type</td>
</tr>
<tr>
<td>Access-Control-Allow-Methods</td>
<td>GET, POST, OPTIONS</td>
</tr>
<tr>
<td>Access-Control-Allow-Origin</td>
<td>*</td>
</tr>
<tr>
<td>Access-Control-Expose-Headers</td>
<td>Origin, Accept, Content-Location, Location, X-Requested-With</td>
</tr>
</tbody>
</table>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
          <a href="../hooks/" title="Hooks" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Hooks
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/cds-hooks" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-8e4952e681.js"></script>
      
      <script>app.initialize({version:"0.17.1",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>